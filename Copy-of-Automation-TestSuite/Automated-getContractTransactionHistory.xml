<?xml version="1.0" encoding="UTF-8"?>
<con:testCase id="50238ff8-ddc9-40b7-a141-a0d05cfae13f" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Automated getContractTransactionHistory" searchProperties="true" xmlns:con="http://eviware.com/soapui/config"><con:settings><con:setting id="IncludeOverview">true</con:setting><con:setting id="IncludeResults">true</con:setting><con:setting id="FlowLayout">true</con:setting><con:setting id="ErrorDetails">true</con:setting><con:setting id="IncludeCoverage">true</con:setting><con:setting id="49f70367-0b83-409e-8faa-a4b2cb7b6c06fileName">Automated-getContractTransactionHistory</con:setting><con:setting id="50238ff8-ddc9-40b7-a141-a0d05cfae13ffileName">Automated-getContractTransactionHistory</con:setting></con:settings><con:savedRecentRuns>1</con:savedRecentRuns><con:testStep type="datasource" name="getExceldata" id="5350178c-f970-414a-9bf9-e5cac35c61d9"><con:settings/><con:config xsi:type="con:DataSourceStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:dataSource type="Excel"><con:configuration><file>C:/CMS Automation/API New/new/apiregression/getContractTransactionHistory.xlsx</file><worksheet>${#Project#Worksheet}</worksheet><cell>A2</cell><ignoreEmpty>true</ignoreEmpty><evaluateFormulas>false</evaluateFormulas></con:configuration></con:dataSource><con:shared>false</con:shared><con:restartShared>false</con:restartShared><con:preload>false</con:preload><con:property>Row</con:property><con:property>ExpectedAPIoutput</con:property><con:property>Scenario</con:property><con:property>contractNumber</con:property><con:property>messageId</con:property><con:property>timestamp</con:property><con:property>clientAppId</con:property><con:property>userId</con:property><con:startRow>0</con:startRow><con:endRow/><con:failOnEmpty>false</con:failOnEmpty><con:gotoLoopOnEmpty>false</con:gotoLoopOnEmpty><con:trimValues>false</con:trimValues><con:entitizeValues>false</con:entitizeValues><con:restartOnRun>true</con:restartOnRun><con:expandProperties>false</con:expandProperties></con:config></con:testStep><con:testStep type="groovy" name="Reset Counter Values" id="b0b3817a-aa8f-41f2-bd7f-af887bdbe009"><con:settings/><con:config><script>log.info "**************TEST SCRIPT START: getContractTransactionHistory API**************"
testRunner.testCase.setPropertyValue( "countIterator", "0" )
testRunner.testCase.setPropertyValue( "XmlCounter", "1" )</script></con:config></con:testStep><con:testStep type="datasource" name="totalTranNumbers" id="77ca380f-21b5-4525-a965-d69f20271461"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.teststeps.datasource.DataSourceContainer@prepared-properties">&lt;xml-fragment/></con:setting></con:settings><con:config xsi:type="con:DataSourceStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:dataSource type="Data Connection"><con:configuration><Connection>DBCALMS2CMS( Default environment )</Connection><query>select COUNT(*) from lytran where ytran_loan =${getExceldata#contractNumber}</query><fetchSize/><stored-procedure>false</stored-procedure></con:configuration></con:dataSource><con:shared>false</con:shared><con:restartShared>false</con:restartShared><con:property>COUNT(*)</con:property><con:startRow>0</con:startRow><con:endRow/><con:completeLastOperation>true</con:completeLastOperation><con:failOnEmpty>false</con:failOnEmpty><con:gotoLoopOnEmpty>false</con:gotoLoopOnEmpty><con:trimValues>true</con:trimValues><con:entitizeValues>false</con:entitizeValues><con:restartOnRun>true</con:restartOnRun><con:expandProperties>false</con:expandProperties></con:config></con:testStep><con:testStep type="request" name="getContractTransactionHistory" id="859c1bd1-e594-43c3-8ac7-73d4322a9378"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>Calms2CMSServiceSOAP</con:interface><con:operation>getContractTransactionHistory</con:operation><con:request name="getContractTransactionHistory" id="548fc1f8-b0cf-4c7d-a8b0-77581941d975" defaultOutgoingWss="" defaultIncomingWss="" outgoingWss="" incomingWss=""><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://nssrvdfsdev01/calms2cms/services/Calms2CMS</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:con="http://www.whiteclarkegroup.com/services/Calms2CMS/schema/Contract" xmlns:com="http://www.whiteclarkegroup.com/services/Calms2CMS/schema/CommonTypes">
   <soapenv:Header/>
   <soapenv:Body>
      <con:getContractTransactionHistory>
         
         <con:externalContractNumber>${getExceldata#contractNumber}</con:externalContractNumber><con:audit>
            <com:messageId>${getExceldata#messageId}</com:messageId>
            <com:timestamp>${getExceldata#timestamp}</com:timestamp>
            <com:clientAppId>${getExceldata#clientAppId}</com:clientAppId>
            <com:userId>${getExceldata#userId}</com:userId><com:clientLanguage>de_DE</com:clientLanguage>
         </con:audit>
      </con:getContractTransactionHistory>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:assertion type="SOAP Response" id="caf736f3-b6b6-4184-b065-9da5c5aede76"/><con:credentials><con:selectedAuthProfile>No Authorization</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:wsaConfig mustUnderstand="NONE" version="200508"/><con:wsrmConfig version="1.2"/><con:environmentSpec><con:entry environmentId="ba5f7dc0-e8db-409c-b494-16037c932774"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="4afb3ac9-5034-4c9c-8880-fc76dd54bdc6"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="3413a0c0-76cc-4f43-9482-3efe9e972e81"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="a32f4f82-e311-4f8a-ba4f-accdfcbdadcf"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="1d61f86f-f9a2-4364-a52c-3d321cfb1a28"><con:authProfile>No Authorization</con:authProfile></con:entry><con:entry environmentId="b796eeee-b2bf-40b2-9d2a-9d00c30d0dab"><con:authProfile>No Authorization</con:authProfile></con:entry><con:entry environmentId="263f20f9-2653-4f33-8d66-1694d38c9931"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="1f7152d8-1be5-485f-bc97-18cbc1aa4ba8"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="646e67d6-aa98-4b13-bf6d-4dc58edc1b75"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="b0665732-cac3-4206-a83b-daa28cab3d19"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="53d9b97b-8073-471c-a279-b4038955f03c"><con:authProfile>Basic admin</con:authProfile></con:entry><con:entry environmentId="3b0f4fd5-8397-4067-b032-ecfa22cfa5ff"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="02782eb4-ecaf-43ac-8f0c-0a1eeebbdd7a"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="15dff999-92e5-4da2-8a61-2a9da4ce2988"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="a48a545f-36b3-49f1-bade-8da1cb59d2fe"><con:authProfile>Basic admin</con:authProfile></con:entry><con:entry environmentId="112f4a66-5a4b-434d-b2bd-545253fd642c"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="4143f28d-a750-4734-bce6-5c2a6d3d7f9c"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="b76764fd-8ea2-4d21-b7df-4cb5351d4f53"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="a6566457-9045-4b25-ac54-078c86d840ea"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="ae8e0480-fa17-44a7-bcc7-f4a450334b74"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="9f36af4a-1bb6-4e88-a92d-65ff3a0063c2"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="1b4cb691-92fd-43d3-8eb1-2fffb04f906d"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="d36d30f7-59cd-4be8-8b69-bbe1d5a35292"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="d2d1977c-5412-4ad0-aead-f799c1228abb"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="31740623-c48a-4d64-ba9e-c19c0684b8f8"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="24ca39f1-63a3-4ac0-932a-b6649948b285"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="016d40b6-6858-4bb5-9df3-ecea7bf8cefe"><con:authProfile>No Authorization</con:authProfile></con:entry></con:environmentSpec></con:request></con:config></con:testStep><con:testStep type="groovy" name="Groovy Script 1" id="7c5ebfe4-b1ac-4550-b6be-81f439370760"><con:settings/><con:config><script>log.info " loop Transactions"</script></con:config></con:testStep><con:testStep type="datasource" name="DataSource" id="5e1bdb12-2a74-4fad-a3e8-2056d3d02919"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.teststeps.datasource.DataSourceContainer@prepared-properties">&lt;xml-fragment/></con:setting></con:settings><con:config xsi:type="con:DataSourceStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:dataSource type="Data Connection"><con:configuration><Connection>DBConnection( Default environment )</Connection><query>select L2.YTRAN_LOAN, L2.YTRAN_NO,YTRAN_ACCT, L2.YTRAN_ARR_BAL, L2.YTRAN_ARR_GOVT, L2.YTRAN_ARR_INT,L2.YTRAN_ARR_MISC, L2.YTRAN_ARR_ODI, L2.YTRAN_ARR_PRINC, L2.YTRAN_BATCH, L2.YTRAN_CODE, L2.YTRAN_CUR_BAL, to_char(to_date(lpad(to_char(L2.YTRAN_DATE),6,'0'),'ddMMyy'),'YYYYMMDD') as YTRAN_DATE, L2.YTRAN_FIRST_INSTAL, to_char(to_date(lpad(to_char(L2.YTRAN_ID_DATE),6,'0'),'ddMMyy'),'YYYYMMDD') as YTRAN_ID_DATE, L2.YTRAN_INT_BEAR, L2.YTRAN_INTEREST_TYPE, L2.YTRAN_LAST_INSTAL, L2.YTRAN_MEMO,   L2.YTRAN_NORM_INSTAL, L2.YTRAN_OS_GOVT, L2.YTRAN_OS_INT, L2.YTRAN_OS_PRINC, L2.YTRAN_PAYMENT_METHOD, L2.YTRAN_REF_NUM, L2.YTRAN_RESIDUAL, L2.YTRAN_SUB_CODE, L2.YTRAN_SYS_DATE,L2.YTRAN_SYS_TIME, L2.YTRAN_USER_ID, L2.YTRAN_VALUE, L2.YTRAN_VALUE_FID,L2.YTRAN_VALUE_INT, L2.YTRAN_VALUE_MISC, L2.YTRAN_VALUE_ODI, L2.YTRAN_VALUE_PRINC, L2.YTRAN_VALUE_SD, L2.YTRAN_VALUE_VAT,L2.YTRAN_PAYMENT_DISHONOURED,
L1.LOAN_ARR_GOVT, L1.LOAN_ARR_MISC, L1.LOAN_ARR_PRINC, L1.LOAN_CUR_BAL, L1.LOAN_NET_PENALTY_INT,L1.LOAN_NO_TRANS,L1.LOAN_PI_DEBITED,L1.LOAN_PI_DEBITED_TM,L1.LOAN_PI_RECOVERED,L1.LOAN_PI_RECOVERED_TM, L3.LEXTN_CREDIT_LOG_NO 
from lytran L2, LLoan L1, llextn L3 
where L2.ytran_loan = L1.LOAN_NUM 
  and L2.ytran_loan = L3.LEXTN_LOAN_NUM
  and L2.ytran_loan = ${getExceldata#contractNumber} and l2.ytran_id_date >0
Union all
select L2.YTRAN_LOAN, L2.YTRAN_NO,YTRAN_ACCT, L2.YTRAN_ARR_BAL, L2.YTRAN_ARR_GOVT, L2.YTRAN_ARR_INT,L2.YTRAN_ARR_MISC, L2.YTRAN_ARR_ODI, L2.YTRAN_ARR_PRINC, L2.YTRAN_BATCH, L2.YTRAN_CODE, L2.YTRAN_CUR_BAL, to_char(to_date(lpad(to_char(L2.YTRAN_DATE),6,'0'),'ddMMyy'),'YYYYMMDD') as YTRAN_DATE, L2.YTRAN_FIRST_INSTAL, '0' as YTRAN_ID_DATE, L2.YTRAN_INT_BEAR, L2.YTRAN_INTEREST_TYPE, L2.YTRAN_LAST_INSTAL, L2.YTRAN_MEMO,   L2.YTRAN_NORM_INSTAL, L2.YTRAN_OS_GOVT, L2.YTRAN_OS_INT, L2.YTRAN_OS_PRINC, L2.YTRAN_PAYMENT_METHOD, L2.YTRAN_REF_NUM, L2.YTRAN_RESIDUAL, L2.YTRAN_SUB_CODE, L2.YTRAN_SYS_DATE,L2.YTRAN_SYS_TIME, L2.YTRAN_USER_ID, L2.YTRAN_VALUE, L2.YTRAN_VALUE_FID,L2.YTRAN_VALUE_INT, L2.YTRAN_VALUE_MISC, L2.YTRAN_VALUE_ODI, L2.YTRAN_VALUE_PRINC, L2.YTRAN_VALUE_SD, L2.YTRAN_VALUE_VAT,L2.YTRAN_PAYMENT_DISHONOURED,
L1.LOAN_ARR_GOVT, L1.LOAN_ARR_MISC, L1.LOAN_ARR_PRINC, L1.LOAN_CUR_BAL, L1.LOAN_NET_PENALTY_INT,L1.LOAN_NO_TRANS,L1.LOAN_PI_DEBITED,L1.LOAN_PI_DEBITED_TM,L1.LOAN_PI_RECOVERED,L1.LOAN_PI_RECOVERED_TM, L3.LEXTN_CREDIT_LOG_NO 
from lytran L2, LLoan L1, llextn L3 
where L2.ytran_loan = L1.LOAN_NUM 
  and L2.ytran_loan = L3.LEXTN_LOAN_NUM
  and l2.ytran_id_date =0
  and L2.ytran_loan =${getExceldata#contractNumber}
  order by 2 desc</query><fetchSize/><stored-procedure>false</stored-procedure></con:configuration></con:dataSource><con:shared>false</con:shared><con:restartShared>false</con:restartShared><con:property>YTRAN_LOAN</con:property><con:property>YTRAN_NO</con:property><con:property>YTRAN_ACCT</con:property><con:property>YTRAN_ARR_BAL</con:property><con:property>YTRAN_ARR_GOVT</con:property><con:property>YTRAN_ARR_INT</con:property><con:property>YTRAN_ARR_MISC</con:property><con:property>YTRAN_ARR_ODI</con:property><con:property>YTRAN_ARR_PRINC</con:property><con:property>YTRAN_BATCH</con:property><con:property>YTRAN_CODE</con:property><con:property>YTRAN_CUR_BAL</con:property><con:property>YTRAN_DATE</con:property><con:property>YTRAN_FIRST_INSTAL</con:property><con:property>YTRAN_ID_DATE</con:property><con:property>YTRAN_INT_BEAR</con:property><con:property>YTRAN_INTEREST_TYPE</con:property><con:property>YTRAN_LAST_INSTAL</con:property><con:property>YTRAN_MEMO</con:property><con:property>YTRAN_NORM_INSTAL</con:property><con:property>YTRAN_OS_GOVT</con:property><con:property>YTRAN_OS_INT</con:property><con:property>YTRAN_OS_PRINC</con:property><con:property>YTRAN_PAYMENT_METHOD</con:property><con:property>YTRAN_REF_NUM</con:property><con:property>YTRAN_RESIDUAL</con:property><con:property>YTRAN_SUB_CODE</con:property><con:property>YTRAN_SYS_DATE</con:property><con:property>YTRAN_SYS_TIME</con:property><con:property>YTRAN_USER_ID</con:property><con:property>YTRAN_VALUE</con:property><con:property>YTRAN_VALUE_FID</con:property><con:property>YTRAN_VALUE_INT</con:property><con:property>YTRAN_VALUE_MISC</con:property><con:property>YTRAN_VALUE_ODI</con:property><con:property>YTRAN_VALUE_PRINC</con:property><con:property>YTRAN_VALUE_SD</con:property><con:property>YTRAN_VALUE_VAT</con:property><con:property>YTRAN_PAYMENT_DISHONOURED</con:property><con:property>LOAN_ARR_GOVT</con:property><con:property>LOAN_ARR_MISC</con:property><con:property>LOAN_ARR_PRINC</con:property><con:property>LOAN_CUR_BAL</con:property><con:property>LOAN_NET_PENALTY_INT</con:property><con:property>LOAN_NO_TRANS</con:property><con:property>LOAN_PI_DEBITED</con:property><con:property>LOAN_PI_DEBITED_TM</con:property><con:property>LOAN_PI_RECOVERED</con:property><con:property>LOAN_PI_RECOVERED_TM</con:property><con:property>LEXTN_CREDIT_LOG_NO</con:property><con:restartOnRun>true</con:restartOnRun></con:config></con:testStep><con:testStep type="groovy" name="Groovy Script" id="6dd03726-63a8-4b55-8033-5da52c651311"><con:settings/><con:config><script><![CDATA[import com.eviware.soapui.model.testsuite.TestRunner.Status
import com.eviware.soapui.support.XmlHolder
import org.apache.log4j.Logger

def response = context.expand('${getContractTransactionHistory#response}')
def holder = new XmlHolder(response)
holder.namespaces["ns1"] = "http://www.whiteclarkegroup.com/services/Calms2CMS/schema/Contract"

def numberOfTransactionsFromXML = holder["count(//ns1:transaction)"]
def cOUNT =  context.expand( '${totalTranNumbers#COUNT(*)}' )

contractNumber = context.expand( '${getExceldata#contractNumber}' )

log.info "Contract Number 	----------------------------" + contractNumber
log.info "Number of YTran Transactions from XML ----------" + numberOfTransactionsFromXML
log.info "Number of YTran Transactions from db Count -----" + cOUNT
if (numberOfTransactionsFromXML == cOUNT) {
	assert true
}else{
	log.info "Number of Ytran records from database does not match the  records from XML response"
	assert false
}

//----------------------------------------------Data from XML ------------------------------------------
def val = holder.getNodeValue('//ns1:getContractTransactionHistoryResponse[1]/ns1:contractTransactionHistoryResponse[1]/ns1:contractTransactionHistory[1]/ns1:transactions[1]/ns1:transaction[1]/ns1:yTranLoan[1]')
def xmlCounter = context.expand( '${#TestCase#XmlCounter}' )
int k = xmlCounter.toInteger() 
def nodeNames =["yTranNo","yTranLoan", "ytranAcct","yTranArrBal", "yTranArrGovt","yTranArrInt", "yTranArrMisc","yTranArrODI", "yTranArrPrinc","yTranBatch", "yTranCode","yTranCurBal", "yTranDate","yTranFirstInstal","yTranIdDate", "yTranIntBear","yTranInterestType", "yTranLastInstal","yTranMemo", "yTranNormInstal","yTranOsGovt", "yTranOsInt","yTranOsPrinc", "yTranPaymentMethod","ytranRefNum", "yTranResidual","yTranSubCode", "yTranSysDate","yTranUserId", "yTranValue","yTranValueFid","yTranValueInt","yTranValueMisc","yTranValueOdi","yTranValuePrinc","yTranValueSd","yTranValueVat","paymentDishonoured","loanArrGovt","loanArrMisc","loanArrPrinc","loanCurBal","loanNetPenaltyInt","loanNoTrans","loanPiDebited","loanPiDebitedTM","loanPiRecovered","loanPiRecoveredTM","lextnCreditLogNo","refundType","tranMemo","description"]
int j=0
def MAX_SIZE = cOUNT.toInteger()
def arr_nodeValueXML = new Object[MAX_SIZE]
def arr_dbValue = new Object[MAX_SIZE]
def arr_nodeName = new Object[MAX_SIZE]
log.info "K Value from counter - XML Counter       "+ k

for (ytrand in nodeNames){	
//try {
	if (holder.getNodeValue('exists(//ns1:transaction['+k+']/ns1:'+ytrand+'[1])')){
//		log.info (ytrand)
		arr_nodeName[j]= ytrand
		arr_nodeValueXML[j] = holder.getNodeValue('//ns1:transaction['+k+']/ns1:'+ytrand+'[1]')
//		log.info "VALUE FROM XML RESPONSE -------------------------------: " + arr_nodeValueXML[j]
	}else{
		nodeValueXML[j] = "0"
//		log.info "string value from dom node when the tag does not exist " + arr_nodeValueXML[j]
	}
	j=j+1

}


//--------------------------------------Data from database ---------------------------------
def yTRAN_NO = context.expand( '${DataSource#YTRAN_NO}' )
def yTRAN_LOAN = context.expand( '${DataSource#YTRAN_LOAN}' )
def yTRAN_ACCT = context.expand( '${DataSource#YTRAN_ACCT}' )
def yTRAN_ARR_BAL = context.expand( '${DataSource#YTRAN_ARR_BAL}' )
def yTRAN_ARR_GOVT = context.expand( '${DataSource#YTRAN_ARR_GOVT}' )
def yTRAN_ARR_INT = context.expand( '${DataSource#YTRAN_ARR_INT}' )
def yTRAN_ARR_MISC = context.expand( '${DataSource#YTRAN_ARR_MISC}' )
def yTRAN_ARR_ODI = context.expand( '${DataSource#YTRAN_ARR_ODI}' )
def yTRAN_ARR_PRINC = context.expand( '${DataSource#YTRAN_ARR_PRINC}' )
def yTRAN_BATCH = context.expand( '${DataSource#YTRAN_BATCH}' )
def yTRAN_CODE = context.expand( '${DataSource#YTRAN_CODE}' )
def YTRAN_CUR_BAL = context.expand( '${DataSource#YTRAN_CUR_BAL}' )
def yTRAN_DATE = context.expand( '${DataSource#YTRAN_DATE}' )
def yTRAN_FIRST_INSTAL = context.expand( '${DataSource#YTRAN_FIRST_INSTAL}' )
def yTRAN_ID_DATE = context.expand( '${DataSource#YTRAN_ID_DATE}' )
def yTRAN_INT_BEAR = context.expand( '${DataSource#YTRAN_INT_BEAR}' )
def yTRAN_INTEREST_TYPE = context.expand( '${DataSource#YTRAN_INTEREST_TYPE}' )
def yTRAN_LAST_INSTAL = context.expand( '${DataSource#YTRAN_LAST_INSTAL}' )
def yTRAN_OS_GOVT = context.expand( '${DataSource#YTRAN_OS_GOVT}' )
def yTRAN_MEMO = context.expand( '${DataSource#YTRAN_MEMO}' )
def yTRAN_NORM_INSTAL = context.expand( '${DataSource#YTRAN_NORM_INSTAL}' )
def yTRAN_OS_INT = context.expand( '${DataSource#YTRAN_OS_INT}' )
def yTRAN_OS_PRINC = context.expand( '${DataSource#YTRAN_OS_PRINC}' )
def yTRAN_PAYMENT_METHOD = context.expand( '${DataSource#YTRAN_PAYMENT_METHOD}' )
def yTRAN_REF_NUM = context.expand( '${DataSource#YTRAN_REF_NUM}' )
def yTRAN_RESIDUAL = context.expand( '${DataSource#YTRAN_RESIDUAL}' )
def yTRAN_SUB_CODE = context.expand( '${DataSource#YTRAN_SUB_CODE}' )
def yTRAN_SYS_DATE = context.expand( '${DataSource#YTRAN_SYS_DATE}' )
def yTRAN_SYS_TIME = context.expand( '${DataSource#YTRAN_SYS_TIME}' )
def yTRAN_USER_ID = context.expand( '${DataSource#YTRAN_USER_ID}' )
def yTRAN_VALUE = context.expand( '${DataSource#YTRAN_VALUE}' )
def yTRAN_VALUE_FID = context.expand( '${DataSource#YTRAN_VALUE_FID}' )
def yTRAN_VALUE_INT = context.expand( '${DataSource#YTRAN_VALUE_INT}' )
def yTRAN_VALUE_MISC = context.expand( '${DataSource#YTRAN_VALUE_MISC}' )
def yTRAN_VALUE_ODI = context.expand( '${DataSource#YTRAN_VALUE_ODI}' )
def yTRAN_VALUE_PRINC = context.expand( '${DataSource#YTRAN_VALUE_PRINC}' )
def yTRAN_VALUE_SD = context.expand( '${DataSource#YTRAN_VALUE_SD}' )
def yTRAN_VALUE_VAT = context.expand( '${DataSource#YTRAN_VALUE_VAT}' )
def yTRAN_PAYMENT_DISHONOURED = context.expand( '${DataSource#YTRAN_PAYMENT_DISHONOURED}' )
def lOAN_NUM = context.expand( '${DataSource#LOAN_NUM}' )
def lOAN_ARR_GOVT = context.expand( '${DataSource#LOAN_ARR_GOVT}' )
def lOAN_ARR_MISC = context.expand( '${DataSource#LOAN_ARR_MISC}' )
def lOAN_ARR_PRINC = context.expand( '${DataSource#LOAN_ARR_PRINC}' )
def lOAN_CUR_BAL = context.expand( '${DataSource#LOAN_CUR_BAL}' )
def lOAN_NET_PENALTY_INT = context.expand( '${DataSource#LOAN_NET_PENALTY_INT}' )
def lOAN_NO_TRANS = context.expand( '${DataSource#LOAN_NO_TRANS}' )
def lOAN_PI_DEBITED = context.expand( '${DataSource#LOAN_PI_DEBITED}' )
def lOAN_PI_DEBITED_TM = context.expand( '${DataSource#LOAN_PI_DEBITED_TM}' )
def lOAN_PI_RECOVERED = context.expand( '${DataSource#LOAN_PI_RECOVERED}' )
def lOAN_PI_RECOVERED_TM = context.expand( '${DataSource#LOAN_PI_RECOVERED_TM}' )
def lEXTN_CREDIT_LOG_NO = context.expand( '${DataSource#LEXTN_CREDIT_LOG_NO}' )
def REFUND_TYPE = "OTHER"
def TRAN_MEMO = context.expand( '${DataSource#YTRAN_MEMO}' )
def DESCRIPTION = context.expand( '${DataSource#YTRAN_MEMO}' )

 log.info "ytran No 	--------------------------------"+yTRAN_NO
//	DESCRIPTION = context.expand( '${DataSource#YTRAN_MEMO}' )
def DESCRIPTIONS ="",TRAN_MEMOS =""
	desValue = DESCRIPTION.split(" ")
	for (value1 in desValue){
		DESCRIPTIONS =  DESCRIPTIONS + value1.trim()+ " "
	}
	
if (yTRAN_CODE.toInteger() == 7 ){
	DESCRIPTION = DESCRIPTIONS.trim()
	yTRAN_MEMO =  DESCRIPTION.trim()
	TRAN_MEMO = DESCRIPTION.trim()
}

if (yTRAN_SUB_CODE.length()==1) {
	yTRAN_SUB_CODE = "0"+yTRAN_SUB_CODE
}
if (yTRAN_CODE.length()==1){
	yTRAN_CODE= "0"+yTRAN_CODE
}
yTRAN_CODE = yTRAN_CODE+":"+yTRAN_SUB_CODE



def dbNames =[yTRAN_NO,yTRAN_LOAN, yTRAN_ACCT,yTRAN_ARR_BAL, yTRAN_ARR_GOVT,yTRAN_ARR_INT, yTRAN_ARR_MISC,yTRAN_ARR_ODI, yTRAN_ARR_PRINC,yTRAN_BATCH, yTRAN_CODE,YTRAN_CUR_BAL, yTRAN_DATE,yTRAN_FIRST_INSTAL,yTRAN_ID_DATE, yTRAN_INT_BEAR,yTRAN_INTEREST_TYPE, yTRAN_LAST_INSTAL,yTRAN_MEMO, yTRAN_NORM_INSTAL,yTRAN_OS_GOVT, yTRAN_OS_INT,yTRAN_OS_PRINC, yTRAN_PAYMENT_METHOD,yTRAN_REF_NUM, yTRAN_RESIDUAL,yTRAN_SUB_CODE, yTRAN_SYS_DATE,yTRAN_USER_ID, yTRAN_VALUE, yTRAN_VALUE_FID,yTRAN_VALUE_INT,yTRAN_VALUE_MISC,yTRAN_VALUE_ODI,yTRAN_VALUE_PRINC,yTRAN_VALUE_SD,yTRAN_VALUE_VAT,yTRAN_PAYMENT_DISHONOURED,lOAN_ARR_GOVT,lOAN_ARR_MISC,lOAN_ARR_PRINC,lOAN_CUR_BAL,lOAN_NET_PENALTY_INT,lOAN_NO_TRANS,lOAN_PI_DEBITED,lOAN_PI_DEBITED_TM,lOAN_PI_RECOVERED, lOAN_PI_RECOVERED_TM,lEXTN_CREDIT_LOG_NO,REFUND_TYPE,TRAN_MEMO,DESCRIPTION]

def h =0
for (dbvalueeach in dbNames){	
		arr_dbValue[h] = dbvalueeach
		h=h+1
}


//---------------------------------------Data validation --------------------------------------------------



for (int g = 0; g<=h;g++){

			if(arr_dbValue[g]==""){
				arr_dbValue[g]= null
			}
			if (g==27){
		
			def xmlValueSystemDate = arr_nodeValueXML[g].take(10)
			xmlValueSystemDate = xmlValueSystemDate.replace("-","")
			arr_nodeValueXML[g] = xmlValueSystemDate
			}

			if (g==12){
				def xmlValueTranDate = arr_nodeValueXML[g].take(10)
			xmlValueTranDate = xmlValueTranDate.replace("-","")
			arr_nodeValueXML[g] = xmlValueTranDate
			}
			if (g==14){
				def xmlValueTranIDDate = arr_nodeValueXML[g].take(10)
			xmlValueTranIDDate = xmlValueTranIDDate.replace("-","")
			arr_nodeValueXML[g] = xmlValueTranIDDate
			}

			if (g==3){ 				
				if (arr_dbValue[g]=='-.01'){
					arr_dbValue[g]=="-0.01"
				}				
			}

			if (g==4){ 
				if (arr_dbValue[g]=="-.01"){
					arr_dbValue[g]=="-0.01"
				}				
			}
			if (g==38){ 
				if (arr_dbValue[g]=="-.01"){
					arr_dbValue[g]=="-0.01"
				}
			}
			
		if(arr_nodeValueXML[g] == arr_dbValue[g] ){
//			log.info "Node name from XMl ---- : "+ arr_nodeName[g]
//			log.info "Value from XMl -----    : "+ arr_nodeValueXML[g] 
//			log.info "Value from db -----     : "+ arr_dbValue[g]
//			log.info "Value from XML response MATCHES  Value  from the db table "
		}
		else{
			if (g!=51 && g!=38 && g!= 4 && g!=3){
			log.info g
			log.info "Node name from XMl ---- : "+ arr_nodeName[g]
			log.info "Value from XMl -----    : "+ arr_nodeValueXML[g] 
			log.info "Value from db ------     : "+ arr_dbValue[g]
			log.error "Value from XML response DOES NOT MATCH  Value  from the db table "
			}
			
		}
	}

if (k < cOUNT.toInteger()){
	k= k+1
}

testRunner.testCase.setPropertyValue( "XmlCounter", k.toString() )

// Reset Values to zero 
j=0
k=0
h=0
log.info "**************TEST SCRIPT END : getContractTransactionHistory API**************"
]]></script></con:config></con:testStep><con:testStep type="datasourceloop" name="DataSource Loop - loop transactions" id="b149b394-6452-4cb1-943d-9afc728e4318"><con:settings/><con:config><dataSourceStep>DataSource</dataSourceStep><targetStep>Groovy Script</targetStep></con:config></con:testStep><con:testStep type="datasourceloop" name="DataSource Loop - Excel" id="1c1e0a77-3262-4342-baa9-8b6ea551aeba" disabled="true"><con:settings/><con:config><dataSourceStep>getExceldata</dataSourceStep><targetStep>Reset Counter Values</targetStep></con:config></con:testStep><con:testStep type="groovy" name="Groovy Script - extra" id="0f057971-69b6-48a5-9c2d-e62dc2d5820c" disabled="true"><con:settings/><con:config><script>
arr_yTranNo= holder.getNodeValues('//ns1:yTranNo')
arr_yTranLoan= holder.getNodeValues('//ns1:yTranLoan')
arr_ytranAcct= holder.getNodeValues('//ns1:ytranAcct')
arr_yTranArrBal= holder.getNodeValues('//ns1:yTranArrBal')
arr_yTranArrGovt= holder.getNodeValues('//ns1:yTranArrGovt')
arr_yTranArrInt= holder.getNodeValues('//ns1:yTranArrInt')
arr_yTranArrMisc= holder.getNodeValues('//ns1:yTranArrMisc')
arr_yTranArrODI= holder.getNodeValues('//ns1:yTranArrODI')
arr_yTranArrPrinc= holder.getNodeValues('//ns1:yTranArrPrinc')
arr_yTranBatch= holder.getNodeValues('//ns1:yTranBatch')
arr_yTranCode= holder.getNodeValues('//ns1:yTranCode')
arr_yTranCurBal= holder.getNodeValues('//ns1:yTranCurBal')
arr_yTranDate = holder.getNodeValues('//ns1:yTranDate')
arr_yTranFirstInstal = holder.getNodeValues('//ns1:yTranFirstInstal')
arr_yTranIntBear = holder.getNodeValues('//ns1:yTranIntBear')
arr_yTranInterestType = holder.getNodeValues('//ns1:yTranInterestType')
arr_yTranLastInstal= holder.getNodeValues('//ns1:yTranLastInstal')
arr_yTranMemo= holder.getNodeValues('//ns1:yTranMemo')
arr_yTranNormInstal= holder.getNodeValues('//ns1:yTranNormInstal')
arr_yTranOsGovt= holder.getNodeValues('//ns1:yTranOsGovt')
arr_yTranOsInt= holder.getNodeValues('//ns1:yTranOsInt')
arr_yTranOsPrinc = holder.getNodeValues('//ns1:yTranOsPrinc')
arr_yTranPaymentMethod = holder.getNodeValues('//ns1:yTranPaymentMethod')
arr_ytranRefNum = holder.getNodeValues('//ns1:ytranRefNum')
arr_yTranResidual = holder.getNodeValues('//ns1:yTranResidual')
arr_yTranSubCode = holder.getNodeValues('//ns1:yTranSubCode')
arr_yTranSysDate = holder.getNodeValues('//ns1:yTranSysDate')
arr_yTranUserId = holder.getNodeValues('//ns1:yTranUserId')
arr_yTranValue = holder.getNodeValues('//ns1:yTranValue')

</script></con:config></con:testStep><con:properties><con:property><con:name>countIterator</con:name><con:value>0</con:value></con:property><con:property><con:name>XmlCounter</con:name><con:value>207</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>0f6af0d4-e278-4300-9f91-2339bf70c463</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>77e58d97-2ba2-41e5-82c5-62abc3dea96b</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>99010f90-2248-4a34-a904-40c9975416a8</con:testStepId><con:status>ENABLED</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>fe69097b-a568-4114-a950-f3f38f69cef7</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>74dfacb0-ff45-46c7-8b86-531b9ef1e7a5</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>6d987b4a-43bd-4678-9dd1-61d5262f2a58</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a4ebc5c0-6f9f-42d5-a085-1f87102e528a</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>297c28b7-440c-4165-86e9-4e9121399426</con:testStepId><con:status>ENABLED</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a9ec2eea-4711-40e4-92f6-ac3706c4c22f</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>9251dc56-a269-400b-9b99-bc6eb40d29e7</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:environmentSpec><con:entry environmentId="ba5f7dc0-e8db-409c-b494-16037c932774"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="4afb3ac9-5034-4c9c-8880-fc76dd54bdc6"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="3413a0c0-76cc-4f43-9482-3efe9e972e81"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="a32f4f82-e311-4f8a-ba4f-accdfcbdadcf"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="263f20f9-2653-4f33-8d66-1694d38c9931"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="1f7152d8-1be5-485f-bc97-18cbc1aa4ba8"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="646e67d6-aa98-4b13-bf6d-4dc58edc1b75"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="b0665732-cac3-4206-a83b-daa28cab3d19"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="53d9b97b-8073-471c-a279-b4038955f03c"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="3b0f4fd5-8397-4067-b032-ecfa22cfa5ff"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="02782eb4-ecaf-43ac-8f0c-0a1eeebbdd7a"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="15dff999-92e5-4da2-8a61-2a9da4ce2988"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="a48a545f-36b3-49f1-bade-8da1cb59d2fe"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="112f4a66-5a4b-434d-b2bd-545253fd642c"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="4143f28d-a750-4734-bce6-5c2a6d3d7f9c"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="b76764fd-8ea2-4d21-b7df-4cb5351d4f53"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="a6566457-9045-4b25-ac54-078c86d840ea"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="ae8e0480-fa17-44a7-bcc7-f4a450334b74"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="9f36af4a-1bb6-4e88-a92d-65ff3a0063c2"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="1b4cb691-92fd-43d3-8eb1-2fffb04f906d"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="d36d30f7-59cd-4be8-8b69-bbe1d5a35292"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="d2d1977c-5412-4ad0-aead-f799c1228abb"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="31740623-c48a-4d64-ba9e-c19c0684b8f8"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="24ca39f1-63a3-4ac0-932a-b6649948b285"><con:authProfile>Inherit From Parent</con:authProfile></con:entry></con:environmentSpec></con:testCase>